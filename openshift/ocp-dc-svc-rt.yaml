# openshift/deploy-svc-route.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo-app
  namespace: demo-cicd
  annotations:
    image.openshift.io/triggers: >
      [{"from":{"kind":"ImageStreamTag","name":"demo-app:latest","namespace":"demo-cicd"},
        "fieldPath":"spec.template.spec.containers[0].image"}]
spec:
  replicas: 2
  selector:
    matchLabels: { app: demo-app }
  template:
    metadata:
      labels: { app: demo-app }
    spec:
      containers:
        - name: app
          image: image-registry.openshift-image-registry.svc:5000/demo-cicd/demo-app:latest
          ports: [{ containerPort: 8080 }]
          readinessProbe: { httpGet: { path: "/", port: 8080 }, initialDelaySeconds: 5 }
          livenessProbe:  { httpGet: { path: "/", port: 8080 }, initialDelaySeconds: 15 }
---
apiVersion: v1
kind: Service
metadata:
  name: demo-app
  namespace: demo-cicd
spec:
  selector: { app: demo-app }
  ports:
    - name: http
      port: 80
      targetPort: 8080
---
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: demo-app
  namespace: demo-cicd
spec:
  to: { kind: Service, name: demo-app }
  port: { targetPort: http }
  tls: { termination: edge }